# 2.0. 安装与使用

ROOT是一个可以帮助你科学地分析PB级数据的强大工具，可以通过[ROOT官网](https://root.cern.ch)及查阅手册来学习：​

{% file src="../.gitbook/assets/ROOT User's Guide Ver.2018.pdf" %}

还有一个简单的在线手册：[https://root.cern.ch/root/htmldoc/guides/primer/ROOTPrimer.html#graphs](https://root.cern.ch/root/htmldoc/guides/primer/ROOTPrimer.html#graphs)

***

## ROOT的安装和使用

ROOT在Linux、MacOS和Win上均可用。在MacOS上安装ROOT极其简单，使用[homebrew](../0.-linux-commands/3.-mac-terminal.md#shi-yong-homebrew-an-zhuang-mac-ruan-jian)即可！

```
$ brew install root
```

其他软件安装方式参考[这里](https://root.cern/install/#macos-package-managers)。

ROOT常用模式有<mark style="color:purple;">**命令行模式、脚本模式、图形界面模式**</mark>，本人非常不推荐使用图形界面，因为这会使你很快遗忘各种类的名称和使用方法，这对于使用脚本模式处理大型数据时是非常不利的。

### 基本命令

配置好ROOT的路径，在终端中输入`root`命令就可以直接运行root程序：

```sh
[zhangzh@node01 ~]$ root
   ------------------------------------------------------------------
  | Welcome to ROOT 6.22/02                        https://root.cern |
  | (c) 1995-2020, The ROOT Team; conception: R. Brun, F. Rademakers |
  | Built for linuxx8664gcc on Aug 17 2020, 12:46:52                 |
  | From tags/v6-22-02@v6-22-02                                      |
  | Try '.help', '.demo', '.license', '.credits', '.quit'/'.q'       |
   ------------------------------------------------------------------

root [0] 
```

root命令也有参数可以选择，`-l`可以忽略版本信息直接进入root，`-q`参数表示在执行完脚本后自动退出到shell，例如：

```bash
[zhangzh@node01 ~]$ root -l -q <filename>
```

进入root后，有一些常用的命令需要知道：

```shell
.ls        # 查看文件结构
.x         # 执行
.q         # 退出
Tab键      # 补全/查看成员函数
```

<details>

<summary>E.g.</summary>

<pre><code>[zhangzh@node01 cernstaff]$ rl cernstaff.root 
root [0] 
Attaching file cernstaff.root as _file0...
(TFile *) 0x265e9c0
root [1] .ls
TFile**		cernstaff.root	
 TFile*		cernstaff.root	
  KEY: TTree	T;1	CERN 1988 staff data    // perform Tree or Branch name
root [2] T->Scan()
************************************************************************************************************
*    Row   * Category. * Flag.Flag *   Age.Age * Service.S * Children. * Grade.Gra * Step.Step * Hrweek.Hr *
************************************************************************************************************
*        0 *       202 *        15 *        58 *        28 *         0 *        10 *        13 *        40 *
*        1 *       530 *        15 *        63 *        33 *         0 *         9 *        13 *        40 *
*        2 *       316 *        15 *        56 *        31 *         2 *         9 *        13 *        40 *
*        3 *       361 *        15 *        61 *        35 *         0 *         9 *         7 *        40 *
*        4 *       302 *        15 *        52 *        24 *         2 *         9 *         8 *        40 *
*        5 *       303 *        15 *        60 *        33 *         0 *         7 *        13 *        40 *
*        6 *       302 *        15 *        53 *        25 *         1 *         9 *         9 *        40 *
*        7 *       361 *        15 *        60 *        32 *         1 *         8 *         5 *        40 *
*        8 *       340 *        15 *        51 *        28 *         0 *         8 *        13 *        40 *
*        9 *       361 *        15 *        56 *        32 *         1 *         7 *        13 *        40 *
*       10 *       361 *        15 *        51 *        29 *         0 *         7 *        13 *        40 *
*       11 *       303 *        15 *        54 *        31 *         2 *         8 *        13 *        40 *
*       12 *       302 *        15 *        54 *        29 *         0 *         7 *        13 *        40 *
*       13 *       300 *        15 *        46 *        25 *         0 *         8 *         6 *        40 *
*       14 *       361 *        15 *        54 *        26 *         1 *         7 *        13 *        40 *
*       15 *       361 *        15 *        57 *        29 *         0 *         7 *        13 *        40 *
*       16 *       316 *        11 *        55 *        28 *         0 *         8 *        11 *        40 *
*       17 *       303 *        15 *        55 *        26 *         1 *         7 *        13 *        40 *
*       18 *       361 *        15 *        57 *        29 *         1 *         7 *         8 *        40 *
*       19 *       361 *        15 *        51 *        28 *         2 *         7 *        13 *        40 *
*       20 *       419 *        13 *        54 *        29 *         0 *         5 *        13 *        40 *
*       21 *       202 *        15 *        57 *        26 *         1 *        12 *        13 *        40 *
*       22 *       304 *        15 *        63 *        29 *         1 *        10 *        13 *        40 *
*       23 *       204 *        15 *        56 *        27 *         0 *        11 *         9 *        40 *
*       24 *       204 *        15 *        49 *        27 *         0 *         9 *         9 *        40 *
Type &#x3C;CR> to continue or q to quit ==> q
************************************************************************************************************
(long long) 25
<strong>root [3] T->Show(24)
</strong>======> EVENT:24
 Category        = 204
 Flag            = 15
 Age             = 49
 Service         = 27
 Children        = 0
 Grade           = 9
 Step            = 9
 Hrweek          = 40
 Cost            = 0
 Division        = 
 Nation          = 
 root [4] T->Print()
******************************************************************************
*Tree    :T         : CERN 1988 staff data                                   *
*Entries :     3354 : Total =          175563 bytes  File  Size =      47246 *
*        :          : Tree compression factor =   3.69                       *
******************************************************************************
*Br    0 :Category  : Category/I                                             *
*Entries :     3354 : Total  Size=      13989 bytes  File Size  =       4919 *
*Baskets :        1 : Basket Size=      32000 bytes  Compression=   2.74     *
*............................................................................*
*Br    1 :Flag      : Flag/i                                                 *
*Entries :     3354 : Total  Size=      13969 bytes  File Size  =       2165 *
*Baskets :        1 : Basket Size=      32000 bytes  Compression=   6.23     *
*............................................................................*
*Br    2 :Age       : Age/I                                                  *
*Entries :     3354 : Total  Size=      13964 bytes  File Size  =       3489 *
*Baskets :        1 : Basket Size=      32000 bytes  Compression=   3.86     *
*............................................................................*
*Br    3 :Service   : Service/I                                              *
*Entries :     3354 : Total  Size=      13984 bytes  File Size  =       2214 *
*Baskets :        1 : Basket Size=      32000 bytes  Compression=   6.09     *
*............................................................................*
*Br    4 :Children  : Children/I                                             *
*Entries :     3354 : Total  Size=      13989 bytes  File Size  =       2110 *
*Baskets :        1 : Basket Size=      32000 bytes  Compression=   6.39     *
*............................................................................*
*Br    5 :Grade     : Grade/I                                                *
*Entries :     3354 : Total  Size=      13974 bytes  File Size  =       2676 *
*Baskets :        1 : Basket Size=      32000 bytes  Compression=   5.04     *
*............................................................................*
*Br    6 :Step      : Step/I                                                 *
*Entries :     3354 : Total  Size=      13969 bytes  File Size  =       2889 *
*Baskets :        1 : Basket Size=      32000 bytes  Compression=   4.67     *
*............................................................................*
*Br    7 :Hrweek    : Hrweek/I                                               *
*Entries :     3354 : Total  Size=      13979 bytes  File Size  =        642 *
*Baskets :        1 : Basket Size=      32000 bytes  Compression=  21.01     *
*............................................................................*
*Br    8 :Cost      : Cost/I                                                 *
*Entries :     3354 : Total  Size=      13965 bytes  File Size  =       6939 *
*Baskets :        1 : Basket Size=      32000 bytes  Compression=   1.94     *
*............................................................................*
*Br    9 :Division  : Division/C                                             *
*Entries :     3354 : Total  Size=      25238 bytes  File Size  =      10048 *
*Baskets :        2 : Basket Size=      32000 bytes  Compression=   2.46     *
*............................................................................*
*Br   10 :Nation    : Nation/C                                               *
*Entries :     3354 : Total  Size=      24123 bytes  File Size  =       7928 *
*Baskets :        2 : Basket Size=      32000 bytes  Compression=   2.98     *
*............................................................................*

</code></pre>

</details>

输入`root <filename>`就可以运行你的脚本，root脚本通常由C、python编写。

在root中要使用操作系统的命令？没问题！

```bash
.!<OS_command>           # 如.!ls或者.!pwd
```

### 多命令行

你可以使用 ROOT 在 ROOT 提示符下执行多行命令。要启动多行命令，请在 ROOT 提示符下键入：`{`

```c
root [0] {
root [1]   int j = 0;
root [2]   for (int i = 0; i < 3; i++)
root [3]   {
root [4]     j = j + i;
root [5]     std::cout << "i = " << i << ", j = " << j << std::endl;
root [6]   }
root [7] }
i = 0, j = 0
i = 1, j = 1
i = 2, j = 3
```

### 参数传递

当脚本需要传入参数时，应该将脚本名和参数使用引号（引号包括单引和双引），参数用括号包裹：

```
root '<filename>(<parameter>)'
```

### 图形界面

ROOT库提供了一个图形界面工具，称为ROOT GUI（图形用户界面），用于交互式地进行数据分析、绘图和可视化，使用户可以通过鼠标和键盘与ROOT库进行交互。除了菜单，你可以以图形化查看tree的结构，还可以在canvas上右击任何位置（轴、坐标点、画布、标题等）来查看和更改它们的成员函数。打开UI界面的命令是：

```shell
root [1] TBrowser <treename>    # 同样可以通过->StartViewer()指令打开图形界面 
```

## 基本概念

### 树 TTree

TTree是ROOT库中的一个重要概念，它是一种用于存储和处理大量结构化数据的数据结构。TTree可以看作是一个表格，其中每一行代表一个事件或数据点，每一列代表一个变量或数据字段。

<details>

<summary>TTree的主要特点包括：</summary>



1. 高效的存储：TTree以一种高度压缩的方式存储数据，可以有效地处理大量的数据。它使用分支（Branch）的概念，将数据按照变量进行组织和存储。
2. 灵活的数据结构：TTree可以存储各种类型的数据，包括整数、浮点数、字符串、数组等。您可以根据需要定义和使用不同类型的数据字段。
3. 高效的读写操作：TTree支持高效的读写操作，您可以将数据写入TTree或从TTree中读取数据。它还支持随机访问数据，可以根据事件编号或索引快速访问特定的数据点。
4. 支持分析和筛选：TTree提供了一些方法和工具，用于对存储的数据进行分析和筛选。您可以使用条件语句、循环和其他操作来处理和筛选数据。
5. 多线程支持：TTree可以在多线程环境下使用，可以并行读取和处理数据，提高数据处理的效率。

它是ROOT库中数据分析和可视化的基础，可以与其他ROOT库中的功能和工具相结合，进行数据分析、绘图和模拟等操作。

</details>

### 枝 TBranch

Branch（分支）是TTree中存储数据的基本单位。每个分支对应TTree中的一列数据，分支的主要作用是将数据按照变量进行组织和存储，使得数据在TTree中的存储和访问更加高效。

每个分支都有一个名称（Branch Name），用于唯一标识该分支。分支还有一个数据类型（Data Type），用于指定存储在该分支中的数据类型，如整数、浮点数、字符串等。此外，分支还可以有一个或多个维度（Dimension），用于存储数组类型的数据。

<details>

<summary>分支的创建和使用主要涉及以下几个步骤：</summary>



1. 创建分支：使用TTree的`Branch()`方法可以创建一个新的分支，并指定分支的名称、数据类型和维度等信息。例如，可以创建一个名为"energy"的分支，存储浮点数类型的能量数据。
2. 填充数据：通过调用分支的`Fill()`方法，可以将数据填充到分支中。每次调用`Fill()`方法，都会将当前的变量值添加到分支中，并进入下一个事件或数据点。
3. 读取数据：可以使用TTree的`SetBranchAddress()`方法来设置分支的地址，以便在读取数据时将数据存储到指定的变量中。通过调用TTree的`GetEntry()`方法，可以读取TTree中的下一个事件或数据点，并将数据填充到指定的变量中。

通过使用分支，可以将大量的结构化数据存储在TTree中，并以高效的方式进行读写和访问。分支的概念使得数据的存储和处理更加灵活和高效，适用于大型数据集的存储和分析。

</details>

使用以下命令查看它们：

```bash
->Show()   # 使用该命令可以指定查看某个编号下的branch，例如Show(24)
           # 注意：展示的数据只会保留6位有效数字，在root中仍以本身的数值存储
->Print()  # 依次打印出每个branch的数据
->Scan()   # 每次扫描25行tree中的数据
           # ->用于通过指针访问对象的成员，这三个函数都是Tree这个类的成员函数
```

### 画布 Canvas

画布是用来承载绘图的窗口或者页面。在画布上可以绘制一个或多个图形区域（Pad），并且可以在画布上设置标题、坐标轴、图例等元素。画布提供了一个整体的绘图区域，可以在一个窗口中同时显示多个图形。

### 图形区域 Pad

图形区域是画布内部的一个独立的绘图区域，可以在上面绘制图形、直方图、函数等。画布上可以包含一个或多个图形区域，每个图形区域可以有自己的坐标轴、标题等属性。通过在画布上创建多个图形区域，可以实现多图并列显示，或者绘制复杂的布局。



## 蒙特卡罗思想 Monte Carlo

蒙特卡洛是位于摩纳哥的赌城，20世纪40年代，由John von Neumann，Stanislaw Ulam和 Nicholas Metropolis 在 Los Alamos National Lab (LANL) 曼哈顿计划中，为模拟中子扩散发展出的一种统计方法。 字如其名，蒙特卡洛方法本质上是跟赌博一样具有随机特性。

通过一个简单的例子，就能让你理解蒙卡的思想精髓：

如果(x,y)是独立地从0到1之间均匀分布抽样出的一系列的数对，那么这些随机的位置坐标(x,y)落在1为半径圆弧内的概率应该是：四分之一圆的面积/整个正方形的面积。

而因为(x,y) 是0到1的均匀分布，所以这个概率当抽样足够多的时候就等于圆内的点数除以总共点数。

这样一来，只要采样足够多，就可以得到无限趋近于 π 的值。



## C程序中使用ROOT

```bash
g++ `root-config --cflags --libs` sample.cxx -o simple
设置r++=g++ `root-config --cflags --libs`后, 可使用r++ sample.cxx -o simple
```



***

## ROOT实例教程

root官方提供了很多例子供你学习，它们在：

```
ls $ROOTSYS/tutorials/
```







{% embed url="https://root.cern.ch/doc/master/classTPad.html" %}



[https://root.cern.ch/doc/master/classTPad.html](https://root.cern.ch/doc/master/classTPad.html)



